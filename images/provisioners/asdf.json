{
  "builders": [],
  "provisioners": [
    {
      "type": "file",
      "source": "./configs",
      "destination": "/tmp/configs"
    },
    {
      "execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'",
      "inline": [
        "echo set debconf to Noninteractive", 
        "echo 'debconf debconf/frontend select Noninteractive' | sudo debconf-set-selections",
        "/usr/bin/cloud-init status --wait",
        "sudo apt-get install fail2ban ufw net-tools zsh zsh-syntax-highlighting zsh-autosuggestions jq build-essential unzip git p7zip libpcap-dev grc -y -qq",
        "useradd -G sudo -s /usr/bin/zsh -m op",
        "/bin/su -l op -c 'wget -q https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O - | sh'",
        "mv /tmp/configs/zshrc /home/op/.zshrc",  
        "chown -R op:users /home/op/",
        "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y",
        "/bin/su -l op -c 'git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.13.1'",
        "/bin/su -l op -c 'source /home/op/.zshrc'",
        "sudo -i -u op <<'EOF'",
        "export PATH=$/home/op/.asdf/bin:/home/op/.asdf/shims:$PATH",
        "asdf current",
        "EOF",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git'",
        "apt-get install -y dirmngr gpg curl gawk",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf install nodejs 20.6.1'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf global nodejs 20.6.1'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf reshim nodejs'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf plugin add ruby https://github.com/asdf-vm/asdf-ruby.git'",
        "sudo apt-get -y install autoconf patch build-essential rustc libssl-dev libyaml-dev libreadline6-dev zlib1g-dev libgmp-dev libncurses5-dev libffi-dev libgdbm6 libgdbm-dev libdb-dev uuid-dev ",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf install ruby 3.2.2'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf global ruby 3.2.2'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf reshim ruby'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf plugin add python https://github.com/danhper/asdf-python.git'",
        "sudo apt update; sudo apt install -y build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev curl libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf install python 3.9.18'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf global python 3.9.18'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf reshim python'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf plugin add golang https://github.com/asdf-community/asdf-golang.git'",
        "apt install coreutils",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf install golang 1.21.1'",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf global golang 1.21.1'",
        "echo '. ~/.asdf/plugins/golang/set-env.zsh' >> /home/op/.zshrc",
        "/bin/su -l op -c '/home/op/.asdf/bin/asdf reshim golang'"
      ], "inline_shebang": "/bin/bash",
	  "type": "shell"
    }
  ]
}
